---
title: "DSP 110 Project - Comic Character Analysis"
output:
  html_notebook: default
  pdf_document: default
---

# Setup and Data Loading

```{r}
library(readr)
library(dplyr)
library(tidyr)
library(lubridate)
library(janitor)
library(coursekata)
library(curl)
```

## Load Data from GitHub

```{r}
# Get DC characters:
comic_characters_dc <- 
  "https://github.com/fivethirtyeight/data/raw/master/comic-characters/dc-wikia-data.csv" %>% 
  read_csv() %>% 
  clean_names() %>% 
  mutate(publisher = "DC")

# Get Marvel characters:
comic_characters_marvel <- 
  "https://github.com/fivethirtyeight/data/raw/master/comic-characters/marvel-wikia-data.csv" %>% 
  read_csv() %>% 
  clean_names() %>% 
  mutate(publisher = "Marvel")
```

## Data Wrangling

```{r}
# Merge two datasets and perform further data wrangling:
comic_characters <-
  comic_characters_dc %>% 
  bind_rows(comic_characters_marvel) %>% 
  separate(first_appearance, c("year2", "month"), ", ", remove = FALSE) %>%
  mutate(
    # If month was missing, set as January and day as 01:
    month = ifelse(is.na(month), "01", month),
    day = "01",
    # Note some years missing:
    date = ymd(paste(year, month, day, sep = "-")),
    align = factor(
      align, 
      levels = c("Bad Characters", "Reformed Criminals", "Netural Characters", "Good Characters"),
      ordered = TRUE)
  ) %>%
  select(publisher, everything(), -c(year2, day))
```

```{r}
str(comic_characters)
```

```{r}
head(comic_characters)
```

## Data Cleaning

Figure out the unique classes for all the variables we'll be using: sex / gender, public identity, alive status, and alignment in order to clean them.

```{r}
unique(comic_characters$sex)
```

```{r}
unique(comic_characters$id)
```

```{r}
unique(comic_characters$alive)
```

```{r}
unique(comic_characters$align)
```

Shorten the class names for cleaner plotting

```{r}
comic_clean <- comic_characters %>%
  mutate(
    sex = recode(
      sex,
      "Male Characters" = "Male",
      "Female Characters" = "Female",
      "Agender Characters" = "Agender",
      "Genderfluid Characters" = "Genderfluid",
      "Genderless Characters" = "Genderless",
      "Transgender Characters" = "Transgender"
    ),
    
    alive = recode(
      alive,
      "Living Characters" = "Living",
      "Deceased Characters" = "Deceased"
    ),
    
    align = recode(
      align,
      "Bad Characters" = "Bad",
      "Reformed Criminals" = "Reformed",
      "Neutral Characters" = "Neutral",
      "Good Characters" = "Good"
))
```

```{r}
total_rows <- nrow(comic_characters)

sex_missing <- sum(is.na(comic_characters$sex))
id_missing <- sum(is.na(comic_characters$id))
alive_missing <- sum(is.na(comic_characters$alive))
align_missing <- sum(is.na(comic_characters$align))

cat("Missing values for each variable:\n")
cat(sprintf("- Sex missing: %d (%.2f%%)\n", 
            sex_missing, 100 * sex_missing / total_rows))
cat(sprintf("- Identity missing: %d (%.2f%%)\n", 
            id_missing, 100 * id_missing / total_rows))
cat(sprintf("- Alive status missing: %d (%.2f%%)\n", 
            alive_missing, 100 * alive_missing / total_rows))
cat(sprintf("- Alignment missing: %d (%.2f%%)\n", 
            align_missing, 100 * align_missing / total_rows))
```

# Data Exploration

## Explore Characters by Publisher

```{r}
comic_clean %>%
count(publisher) %>%
arrange(desc(n))

gf_bar(~publisher, data = comic_clean) %>%
gf_labs(title = "Number of Characters by Publisher")
```

## Explore Characters by Gender

```{r}
comic_clean %>%
count(sex) %>%
arrange(desc(n))

gf_bar(~sex, data = comic_clean) %>%
gf_labs(title = "Distribution of Character Genders")
```

## Explore Characters by Public Identity

```{r}
comic_clean %>%
count(id) %>%
arrange(desc(n))

plot <- gf_bar(~id, data = comic_clean) %>%
gf_labs(title = "Distribution of Identity Types (All Characters)")

plot + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Explore Characters by Moral Alignment

```{r}
comic_clean %>%
count(align) %>%
arrange(desc(n))

plot <- gf_bar(~align, data = comic_clean) %>%
  gf_labs(title = "Distribution of Character Alignment",
          y = "Count")

plot + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

# Research Question 1: Does gender influence secret identity status?

Now that we've explored the different distributions of main variables a character can have, we explore if certain characters are more likely to have a secret identity based on their gender. We limit to male and female characters and public vs. secret identities based on those classes dominating the dataset.

```{r}
by_gender_MF <- comic_clean %>%
  filter(sex %in% c("Male", "Female"))
```

```{r}
by_gender_MF %>%
  gf_bar(~sex, fill = ~id, position = "fill") %>%
  gf_labs(
    title = "Proportion of Secret vs Public Identities Within Each Gender",
    y = "Proportion",
    x = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

by_gender_MF %>%
  filter(id %in% c("Secret Identity", "Public Identity")) %>%
  gf_bar(~sex, fill = ~id, position = "fill") %>%
  gf_labs(
    title = "Proportion of Secret vs Public Identities For Male & Female",
    y = "Proportion",
    x = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Calculate Probabilities

```{r}
prob_table <- by_gender_MF %>%
  filter(id %in% c("Secret Identity", "Public Identity")) %>%
  count(sex, id) %>%
  group_by(sex) %>%
  mutate(prop = n / sum(n)) %>%
  filter(sex %in% c("Male", "Female"),
         id == "Secret Identity")

prob_table
```

```{r}
p_secret_male <- prob_table$prop[prob_table$sex == "Male"]
p_secret_female <- prob_table$prop[prob_table$sex == "Female"]
diff_secret <- p_secret_male - p_secret_female

cat("P(Secret | Male)   =", round(p_secret_male, 4), "\n")
cat("P(Secret | Female) =", round(p_secret_female, 4), "\n")
cat("Difference =", round(diff_secret, 4), "\n")
```

## Conclusions

We wanted to know if a character's sex/gender affects their likelihood of having a secret identity, whether P(Secret \| Male) is approximately equal to P(Secret \| Female). If those two probabilities are roughly equal then gender and identity status can be considered independent.

Male and female characters dominate the dataset when it comes to the sex variable. There is not enough data to make a meaningful conclusion about any of the other gendered characters given the distributions in section 1 .

There is a notable imbalance of about a 3:1 ratio of male to female characters in this dataset, but their proportion of secret identities are almost identical.

Since P(Secret \| Male) = 0.55 and P(Secret \| Female) = 0.54, the difference in proportions P(Secret \| Male) - P(Secret \| Female) = 0.0146. We can reasonably conclude that P(Secret \| Gender) approximately equals P(Secret), meaning gender and secret identity status appear approximately independent in this dataset. We can conclude that knowing a character's gender gives little information about whether they have a secret identity.

# Research Question 2: Have more female or male characters appeared in comics over time?

We know from the preliminary EDA that more male characters have appeared over time but this question is trying to understand:

1.  How many characters were introduced each year for each gender?

2.  Is the number increasing over time and how strongly?

3.  Does the trend differ between male and female characters?

```{r}
# Filter for male and female characters that have a valid year introduced
gender_year <- comic_clean %>%
  filter(sex %in% c("Male", "Female"),
         !is.na(year)) %>%
  mutate(year = as.numeric(year))

# Count the number per gender each year
gender_counts <- gender_year %>%
  group_by(year, sex) %>%
  summarise(count = n(), .groups = "drop")

# Plot a line graph for both genders
gf_line(count ~ year, color = ~sex, data = gender_counts) %>%
  gf_labs(
    title = "Characters Introduced Over Time by Gender",
    x = "Year",
    y = "Count",
    color = "Gender"
  )
```

## Linear Model

```{r}
male_counts <- gender_counts %>% filter(sex == "Male")
female_counts <- gender_counts %>% filter(sex == "Female")

model_male <- lm(count ~ year, data = male_counts)
model_female <- lm(count ~ year, data = female_counts)

summary(model_male)
summary(model_female)
```

To examine whether male or female characters were introduced more frequently over time, we counted all characters by gender for each year and applied linear models.

Male characters produced a positive slope of 4.16 with a p value \< 1e-13, meaning publishers introduced about 4 additional male characters each year. The model explains 54% of the variation (R² = 0.539).

Female introductions also increased significantly over time, with a slope of 2.36 and a p value p \< 2e-16. Female characters introduced rose more consistently (R² = 0.739), though the total numbers were always lower than male characters.

While both genders show strong upward trends, male characters grow faster in absolute terms. However, because the female model fits better, the growth in female characters is more stable over time. Female representation increased especially after 1980, even though proportion of males remained dominant.

## Empty Model vs. Linear Model

```{r}
empty_male <- lm(count ~ 1, data = male_counts)
empty_female <- lm(count ~ 1, data = female_counts)

anova(empty_male, model_male)
anova(empty_female, model_female)
```

The empty model here assumes every year introduces the same amount of characters. There is no year predictor like in the linear model before. For both male and female characters, the ANOVA comparison showed that adding “year” significantly improves the model fit.

As can be seen the RSS droped significantly for both male and female. And the extremely small p-values indicates that year is a highly significant predictor of the number of male characters introduced.

So these results confirm the number of characters introduced per year has increased significantly and has a real upward trend and not just due to randomness.

```{r}
confint(model_male)
confint(model_female)
```

## Ratio of Male : Female Characters Over Time

Here we plot the ratio of male to female characters over time to get a better idea of how they compare. The ratio is always above 1, meaning more males than females are introduced every year. At first the graph oscilates heavily due to limited female character, but it steadily declines and smooths out over time, indicating more female character introductions.

```{r}
# Compute male/female ratio
gender_counts <- gender_counts %>%
  mutate(
    ratio = ifelse(Female == 0, NA, Male / Female)  # NA for divide-by-zero
  )

gf_line(ratio ~ year, data = gender_counts, color = "blue") %>%
  gf_labs(
    title = "Male-to-Female Character Introduction Ratio Over Time",
    x = "Year",
    y = "Male : Female Ratio"
  ) %>%
  gf_theme(theme_minimal())
```

## Conclusions

Across the full dataset, male characters have always been introduced in greater numbers than female characters. However, examining yearly counts shows a clear upward trend in the number of female characters introduced, especially from the 1980s onward.

When we compared the two groups directly, the male-to-female introduction ratio steadily declines over time, but is still male dominated even in recent data.

The linear model confirms this pattern statistically: The "year" variable is a meaningful predictor of the number of female characters introduced, showing a positive relationship between time and female representation.

# Research Question 3: Do characters of different alignments differ in their number of comic appearances?

```{r}
# The data is skewed since there are a lot of characters with low numbers of apperances, to see better trends, we are looking at characters with more than 200 appearances and less than 200 appearances..
# We are also looking at this distributes PER character alignment to see if that changes.
#more than 300
gf_histogram(~ appearances | align, data = comic_clean %>% filter(appearances > 200, !is.na(align))) %>%
  gf_labs(
    title = "Distribution of Comic Appearances (< 200)",
    x="Appearances",
    y="Count"
  )

# less than 200
gf_histogram(~ appearances | align, data = comic_clean %>% filter(appearances < 200, !is.na(align))) %>%
  gf_labs(
    title = "Distribution of Comic Appearances (< 200)",
    x="Appearances",
    y="Count"
  )



```

## And are certain alignments more likely to be living or deceased?

```{r}
comic_clean %>%
  filter(!is.na(align), !is.na(alive)) %>%
  group_by(align, alive) %>%
  summarise(n = n()) %>%
  mutate(prop = n / sum(n))

gf_bar(
  ~ align, 
  fill = ~ alive,
  data = comic_clean %>% filter(!is.na(align), !is.na(alive)),
  position = "fill"
) %>%
  gf_labs(
    title = "Proportion of Living vs Deceased by Alignment",
    x = "Alignment",
    y = "Proportion"
  )

# Filter out missing alignments
appearance_data <- comic_clean %>%
  filter(!is.na(align), !is.na(appearances))

# Fit one-way ANOVA
anova_model <- aov(appearances ~ align, data = appearance_data)

# View ANOVA table
summary(anova_model)

#The F-value  is very large, and the p-value is effectively zero, which means we can reject the null hypothesis that all alignment groups have the same mean.
#Characters’ moral alignment is strongly associated with how often they appear in comics—some alignments consistently have more or fewer appearances than others

alignment_summary <- comic_clean %>%
  filter(!is.na(align)) %>%
  group_by(align) %>%
  summarise(
    mean_appearances = mean(appearances, na.rm = TRUE),
    median_appearances = median(appearances, na.rm = TRUE),
    sd_appearances = sd(appearances, na.rm = TRUE),
    min_appearances = min(appearances, na.rm = TRUE),
    max_appearances = max(appearances, na.rm = TRUE),
    n = n()
  )

print(alignment_summary)

#Good characters have the highest average appearances, but the median is low → indicates a few “superstar” characters dominate appearances.
#Bad characters appear least frequently on average, and the low median confirms most appear rarely.
#Reformed characters are intermediate, both in mean and median.
#The large Standard Deviation for Good characters highlights skewness—a few characters appear a lot, many appear few times.

```
