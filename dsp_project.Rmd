---
title: "DSP 110 Project - Comic Character Analysis"
output:
  html_notebook: default
  pdf_document: default
---

# Setup and Data Loading

```{r}
library(readr)
library(dplyr)
library(tidyr)
library(lubridate)
library(janitor)
library(coursekata)
library(curl)
```

## Load Data from GitHub

```{r}
# Get DC characters:
comic_characters_dc <- 
  "https://github.com/fivethirtyeight/data/raw/master/comic-characters/dc-wikia-data.csv" %>% 
  read_csv() %>% 
  clean_names() %>% 
  mutate(publisher = "DC")

# Get Marvel characters:
comic_characters_marvel <- 
  "https://github.com/fivethirtyeight/data/raw/master/comic-characters/marvel-wikia-data.csv" %>% 
  read_csv() %>% 
  clean_names() %>% 
  mutate(publisher = "Marvel")
```

## Data Wrangling

```{r}
# Merge two datasets and perform further data wrangling:
comic_characters <-
  comic_characters_dc %>% 
  bind_rows(comic_characters_marvel) %>% 
  separate(first_appearance, c("year2", "month"), ", ", remove = FALSE) %>%
  mutate(
    # If month was missing, set as January and day as 01:
    month = ifelse(is.na(month), "01", month),
    day = "01",
    # Note some years missing:
    date = ymd(paste(year, month, day, sep = "-")),
    align = factor(
      align, 
      levels = c("Bad Characters", "Reformed Criminals", "Netural Characters", "Good Characters"),
      ordered = TRUE)
  ) %>%
  select(publisher, everything(), -c(year2, day))
```

```{r}
str(comic_characters)
```

```{r}
head(comic_characters)
```

## Data Cleaning

Figure out the unique classes for all the variables we'll be using: sex / gender, public identity, alive status, and alignment in order to clean them.

```{r}
unique(comic_characters$sex)
```

```{r}
unique(comic_characters$id)
```

```{r}
unique(comic_characters$alive)
```

```{r}
unique(comic_characters$align)
```

Shorten the class names for cleaner plotting

```{r}
comic_clean <- comic_characters %>%
  mutate(
    sex = recode(
      sex,
      "Male Characters" = "Male",
      "Female Characters" = "Female",
      "Agender Characters" = "Agender",
      "Genderfluid Characters" = "Genderfluid",
      "Genderless Characters" = "Genderless",
      "Transgender Characters" = "Transgender"
    ),
    
    alive = recode(
      alive,
      "Living Characters"   = "Living",
      "Deceased Characters" = "Deceased"
    ),
    
    align = recode(
      align,
      "Bad Characters"      = "Bad",
      "Reformed Criminals"  = "Reformed",
      "Neutral Characters"  = "Neutral",
      "Good Characters"     = "Good"
))
```

```{r}
total_rows <- nrow(comic_characters)

sex_missing <- sum(is.na(comic_characters$sex))
id_missing <- sum(is.na(comic_characters$id))
alive_missing <- sum(is.na(comic_characters$alive))
align_missing <- sum(is.na(comic_characters$align))

cat("Missing values for each variable:\n")
cat(sprintf("- Sex missing: %d (%.2f%%)\n", 
            sex_missing, 100 * sex_missing / total_rows))
cat(sprintf("- Identity missing: %d (%.2f%%)\n", 
            id_missing, 100 * id_missing / total_rows))
cat(sprintf("- Alive status missing: %d (%.2f%%)\n", 
            alive_missing, 100 * alive_missing / total_rows))
cat(sprintf("- Alignment missing: %d (%.2f%%)\n", 
            align_missing, 100 * align_missing / total_rows))
```

# Data Exploration

## Explore Characters by Publisher

```{r}
comic_clean %>%
count(publisher) %>%
arrange(desc(n))

gf_bar(~publisher, data = comic_clean) %>%
gf_labs(title = "Number of Characters by Publisher")
```

## Explore Characters by Gender

```{r}
comic_clean %>%
count(sex) %>%
arrange(desc(n))

gf_bar(~sex, data = comic_clean) %>%
gf_labs(title = "Distribution of Character Genders")
```

## Explore Characters by Public Identity

```{r}
comic_clean %>%
count(id) %>%
arrange(desc(n))

plot <- gf_bar(~id, data = comic_clean) %>%
gf_labs(title = "Distribution of Identity Types (All Characters)")

plot + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Explore Characters by Moral Alignment

```{r}
comic_clean %>%
count(align) %>%
arrange(desc(n))

plot <- gf_bar(~align, data = comic_clean) %>%
  gf_labs(title = "Distribution of Character Alignment",
          y = "Count")

plot + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

# Research Question 1: Does gender influence secret identity status?

Now that we've explored the different distributions of main variables a character can have, we explore if certain characters are more likely to have a secret identity based on their gender. We limit to male and female characters and public vs. secret identities based on those classes dominating the dataset.

```{r}
by_gender_MF <- comic_clean %>%
  filter(sex %in% c("Male", "Female"))
```

```{r}
by_gender_MF %>%
  gf_bar(~sex, fill = ~id, position = "fill") %>%
  gf_labs(
    title = "Proportion of Secret vs Public Identities Within Each Gender",
    y = "Proportion",
    x = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

by_gender_MF %>%
  filter(id %in% c("Secret Identity", "Public Identity")) %>%
  gf_bar(~sex, fill = ~id, position = "fill") %>%
  gf_labs(
    title = "Proportion of Secret vs Public Identities For Male & Female",
    y = "Proportion",
    x = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Calculate Probabilities

```{r}
prob_table <- by_gender_MF %>%
  filter(id %in% c("Secret Identity", "Public Identity")) %>%
  count(sex, id) %>%
  group_by(sex) %>%
  mutate(prop = n / sum(n)) %>%
  filter(sex %in% c("Male", "Female"),
         id == "Secret Identity")

prob_table
```

```{r}
p_secret_male <- prob_table$prop[prob_table$sex == "Male"]
p_secret_female <- prob_table$prop[prob_table$sex == "Female"]
diff_secret <- p_secret_male - p_secret_female

cat("P(Secret | Male)   =", round(p_secret_male, 4), "\n")
cat("P(Secret | Female) =", round(p_secret_female, 4), "\n")
cat("Difference =", round(diff_secret, 4), "\n")
```

## Conclusions

We wanted to know if a character's sex/gender affects their likelihood of having a secret identity, whether P(Secret \| Male) is approximately equal to P(Secret \| Female). If those two probabilities are roughly equal then gender and identity status can be considered independent.

Male and female characters dominate the dataset when it comes to the sex variable. There is not enough data to make a meaningful conclusion about any of the other gendered characters given the distributions in section 1 .

There is a notable imbalance of about a 3:1 ratio of male to female characters in this dataset, but their proportion of secret identities are almost identical.

Since P(Secret \| Male) = 0.55 and P(Secret \| Female) = 0.54, the difference in proportions P(Secret \| Male) - P(Secret \| Female) = 0.0146. We can reasonably conclude that P(Secret \| Gender) approximately equals P(Secret), meaning gender and secret identity status appear approximately independent in this dataset. We can conclude that knowing a character's gender gives little information about whether they have a secret identity.

# Research Question 2: How do female characters added over time?

```{r female-characters-timeline, fig.width=10, fig.height=6}
# Filter for female characters with valid year and identity data
female_data <- comic_clean %>%
  filter(sex == "Female", 
         !is.na(year)) %>%
  mutate(year = as.numeric(year))

# Create scatterplot with jitter
gf_jitter(id ~ year, data = female_data, color = ~ id, 
          height = 0.2, alpha = 0.6, size = 2) %>%
  gf_labs(
    title = "Female Characters' Identity Type by Year of Introduction",
    x = "Year Introduced",
    y = "Identity Type",
    color = "Identity Type"
  ) %>%
  gf_theme(theme_minimal()) %>%
  gf_theme(legend.position = "bottom")

# Summary statistics by decade
female_decade <- female_data %>%
  mutate(decade = floor(year / 10) * 10) %>%
  group_by(decade, id) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(decade) %>%
  mutate(prop = count / sum(count))

# Plot proportion over time
gf_col(prop ~ decade, fill = ~ id, data = female_decade, position = "fill") %>%
  gf_labs(
    title = "Proportion of Female Characters with Secret vs Public Identity by Decade",
    x = "Decade",
    y = "Proportion",
    fill = "Identity Type"
  ) %>%
  gf_theme(theme_minimal()) %>%
  gf_refine(scale_y_continuous(labels = scales::percent))

# Count female characters introduced each year
female_year_counts <- female_data %>%
  group_by(year) %>%
  summarise(count = n(), .groups = "drop")

# Plot number introduced per year
gf_col(count ~ year, data = female_year_counts) %>%
  gf_labs(
    title = "Number of Female Characters Introduced Each Year",
    x = "Year",
    y = "Count of Female Characters"
  ) %>%
  gf_theme(theme_minimal())

male_data <- comic_clean %>%
  filter(sex == "Male", 
         !is.na(year)) %>%
  mutate(year = as.numeric(year))

male_year_counts <- male_data %>%
  group_by(year) %>%
  summarise(count = n(), .groups = "drop")

gf_col(count ~ year, data = male_year_counts) %>%
  gf_labs(
    title = "Number of Male Characters Introduced Each Year",
    x = "Year",
    y = "Count of Female Characters"
  ) %>%
  gf_theme(theme_minimal())

# Calculate proportions for modeling
female_prop <- female_data %>%
  group_by(year) %>%
  summarise(
    total = n(),
    secret_count = sum(id == "Secret Identity"),
    prop_secret = secret_count / total
  )

#empty_model <- lm(prop_secret ~ NULL, data = female_prop)
# Intercept-only model (baseline mean)
empty_model <- lm(prop_secret ~ 1, data = female_prop)


cat("Empty Model Summary:\n")
summary(empty_model)
cat("\nBaseline (mean proportion of secret identities):", round(coef(empty_model), 4), "\n")

# Model with year as predictor
year_model <- lm(prop_secret ~ year, data = female_prop)

cat("\n\nYear Model Summary:\n")
summary(year_model)

# Compare models
cat("\n\nModel Comparison:\n")
cat("Empty Model R-squared:", round(summary(empty_model)$r.squared, 4), "\n")
cat("Year Model R-squared:", round(summary(year_model)$r.squared, 4), "\n")

# Scatterplot with regression line
gf_point(prop_secret ~ year, data = female_prop, 
         size = ~ total, alpha = 0.6, color = "purple") %>%
  gf_lm(color = "blue", linewidth = 1.5) %>%
  gf_labs(
    title = "Female Characters: Proportion with Secret Identity Over Time",
    subtitle = "With linear regression trendline and 95% confidence interval",
    x = "Year Introduced",
    y = "Proportion with Secret Identity",
    size = "# Characters"
  ) %>%
  gf_theme(theme_minimal()) %>%
  gf_refine(scale_y_continuous(labels = scales::percent))
# Filter for male characters

male_data <- comic_clean %>%
filter(sex == "Male", !is.na(year)) %>%
mutate(year = as.numeric(year))

# Calculate proportion secret by year for each sex

male_prop <- male_data %>%
group_by(year) %>%
summarise(
total = n(),
secret_count = sum(id == "Secret Identity"),
prop_secret = secret_count / total,
sex = "Male",
.groups = "drop"
)

female_prop <- female_data %>%
group_by(year) %>%
summarise(
total = n(),
secret_count = sum(id == "Secret Identity"),
prop_secret = secret_count / total,
sex = "Female",
.groups = "drop"
)

combined_prop <- bind_rows(female_prop, male_prop)

# Scatterplot with trendlines for both male & female

gf_point(prop_secret ~ year,
data = combined_prop,
color = ~sex,
size = ~total,
alpha = 0.6) %>%
gf_lm(color = ~sex, linewidth = 1.4) %>%
gf_labs(
title = "Proportion with Secret Identity Over Time (Male vs Female)",
subtitle = "Each sex shown with its own trendline and weighted point sizes",
x = "Year Introduced",
y = "Proportion with Secret Identity",
color = "Sex",
size = "# Characters"
) %>%
gf_theme(theme_minimal()) %>%
gf_refine(scale_y_continuous(labels = scales::percent)) %>%
gf_theme(legend.position = "bottom")

```

# Research Question 3: Do characters of different alignments differ in their number of comic appearances?

```{r}
# The data is skewed since there are a lot of characters with low numbers of apperances, to see better trends, we are looking at characters with more than 200 appearances and less than 200 appearances..
# We are also looking at this distributes PER character alignment to see if that changes.
#more than 300
gf_histogram(~ appearances | align, data = comic_clean %>% filter(appearances > 200, !is.na(align))) %>%
  gf_labs(
    title = "Distribution of Comic Appearances (< 200)",
    x="Appearances",
    y="Count"
  )

# less than 200
gf_histogram(~ appearances | align, data = comic_clean %>% filter(appearances < 200, !is.na(align))) %>%
  gf_labs(
    title = "Distribution of Comic Appearances (< 200)",
    x="Appearances",
    y="Count"
  )



```

## And are certain alignments more likely to be living or deceased?

```{r}
comic_clean %>%
  filter(!is.na(align), !is.na(alive)) %>%
  group_by(align, alive) %>%
  summarise(n = n()) %>%
  mutate(prop = n / sum(n))

gf_bar(
  ~ align, 
  fill = ~ alive,
  data = comic_clean %>% filter(!is.na(align), !is.na(alive)),
  position = "fill"
) %>%
  gf_labs(
    title = "Proportion of Living vs Deceased by Alignment",
    x = "Alignment",
    y = "Proportion"
  )

# Filter out missing alignments
appearance_data <- comic_clean %>%
  filter(!is.na(align), !is.na(appearances))

# Fit one-way ANOVA
anova_model <- aov(appearances ~ align, data = appearance_data)

# View ANOVA table
summary(anova_model)

#The F-value  is very large, and the p-value is effectively zero, which means we can reject the null hypothesis that all alignment groups have the same mean.
#Characters’ moral alignment is strongly associated with how often they appear in comics—some alignments consistently have more or fewer appearances than others

alignment_summary <- comic_clean %>%
  filter(!is.na(align)) %>%
  group_by(align) %>%
  summarise(
    mean_appearances = mean(appearances, na.rm = TRUE),
    median_appearances = median(appearances, na.rm = TRUE),
    sd_appearances = sd(appearances, na.rm = TRUE),
    min_appearances = min(appearances, na.rm = TRUE),
    max_appearances = max(appearances, na.rm = TRUE),
    n = n()
  )

print(alignment_summary)

#Good characters have the highest average appearances, but the median is low → indicates a few “superstar” characters dominate appearances.
#Bad characters appear least frequently on average, and the low median confirms most appear rarely.
#Reformed characters are intermediate, both in mean and median.
#The large Standard Deviation for Good characters highlights skewness—a few characters appear a lot, many appear few times.

```
